---
title: "CPaaS SDK for business communication solutions | Rainbow"
description: "Add chat, conference, real time collaboration and communication (PBX, VoIP, P2P) capabilities, bots and more to your business applications."
type: "sdk"
source: "/docs/sdk/csharp/core/lts/guides/035_events_mode"
lastSynced: "2026-02-20T07:47:21.980Z"
---
# Documentation

XMPP, S2S and Webhook

LTS release 3.XPublished on 2025-03-17

## XMPP, S2S (Server to server) and Webhook

This guide describes how to select an event mode (XMPP, S2S and even no event) and how they are working (architecture, code snippet).

It also describes the possibility of using webhooks in addition.

### Event mode

---

By default, the CSharp SDK uses XMPP to handle events from server using a Web socket.

It's also possible to receive events using S2S (Server to Server).

You can also choose to use no event mode.

Events permis to know (for example) when a message has been received, when someone has added you in a bubble, when someone chnaged his presence (online, busy, ...), etc ...

This event are linked to the user connected with the SDK.

The CSharp SDK allows you, almost transparently, to use one of these event modes without the need for specific code. Only some events and methods are not available/allowed in S2S event mode (Cf. [Events and Methods available](/docs/sdk/csharp)).

#### Select an event mode

---

To select a specific event mode, you only need to set if before the login to the Rainbow Server using `EventMode` property from `Restrictions` object accessible in `Rainbow.Application`.

By default, the event mode selected is XMPP. If you choose S2S event mode, you also need to specify a callback URL. See next chapter to understand the architecture involved in S2S and why/how the callback URL is used.

```csharp
String callbackUrl = "https://myWebServer.com/callbackPath";

Rainbow.Application myApp = new Rainbow.Application();

// To set S2S as event mode
myApp.Restrictions.EventMode = Restrictions.SDKEventMode.S2S;

// Need to specify in S2S event mode the Callback URL used to receive events
myApp.SetS2SCallbackUrl(callbackUrl);

// To set no event mode
myApp.Restrictions.EventMode = Restrictions.SDKEventMode.NONE;

// To set XMPP as event mode (it's the default mode)
myApp.Restrictions.EventMode = Restrictions.SDKEventMode.XMPP;

// Now we can specify the Application ID, the Secret Key and the hostnam to use like always  
myApp.SetApplicationInfo(applicationID, secretKey);
myApp.SetHostInfo(hostname);

// And finally start the login
var loginTask = myApp.LoginAsync(login, password);
```

#### Event mode and architecture

---

When XMPP Event mode is used, a WebSocket is created between the SDK and the Rainbow cloud server to receive events from server but also to send data for IM and Presence features.

REST API is also used to get data from Server

![](/docs/sdk/csharp)

#### S2S event mode and architecture

---

When S2S Event mode is used, there is no web socket but a callback URL is used to received events from Server.

REST API is used to get data from Server and also to manage IM and Presence features.

So if you want to handle a lot of messages you can scale your architecture using a load balancer.

![](/docs/sdk/csharp)

#### S2S event mode - handle events from Rainbow server

---

In XMPP event mode, you have nothing to do to deal with incoming data from the web socket. They are automatically parsed internally and according the result an event is raised by the SDK.

In S2S event mode, it's a little different. It's up to you to configure your web server, set the correct callbackURL and give to SDK the content of data received on it.

Your web server will receive data

-   with a specific HTTP verb (GET, POST, PUT, etc...)
-   with a specific absolute path (for example `mypath` based on the previous screenshoot since the callback URL used is `https://my.server.domain/mypath`)
-   with a specific content (JSON content)
-   with a content type

You must check that the `content type` is equal to `application/json`.

For the 3 other data, you don't have to analyse / parse, you just need to provide them to the SDK - then it will parse the information, and, like in XMPP mode, according the result, an event is raised by the SDK.

To do this you have to use the method `ParseCallbackContent` of the `S2SEventPipe` object. This method returns a boolean to indicate if the parsing has been done correctly or not.

Your web server must always return an HTTP 200 Ok answer even if the parsing hhs not been done correclty.

```csharp
Rainbow.Application myApp = new Rainbow.Application();
Rainbow.S2SEventPipe s2sEventPipe = Rainbow.S2SEventPipe.Instance;
...

// You specify a valid S2S callbackURL to your Rainbow.Appliaction object
myApp.SetS2SCallbackUrl(exeSettings.S2SCallbackURL);

// You set correctly AppdId, AppSecret, HostName and a valid account (login + pwd) using your Rainbow.Appliaction object

// You start the login ...

...

// Your Web server is receiving data from the Rainbow Server
protected override async Task OnRequestAsync(IHttpContext context)
{
    // We get the HTTP verb of the request (POST, GET, ...)
    String httpVerb = context.Request.HttpVerb.ToString();
    
    // We get the AbsolutePath of the request
    String absolutePath = context.Request.Url.AbsolutePath;
    
    // We get the body of the request
    String body = await context.GetRequestBodyAsStringAsync();
    
    // And finnaly we need the content-type of the body
    String? contentType = context.Request.Headers["Content-Type"];
         

    // We use Rainbow.S2SEventPipe instance with this info
    Boolean result = false;
    log.LogDebug("[OnRequestAsync] RequestedPath:[{Path}] - HttpVerb:[{HttpVerb}]", absolutePath, httpVerb);

    if (contentType == "application/json")
    {
        result = await s2sEventPipe.ParseCallbackContentAsync(httpVerb, absolutePath, body);
    }
}
```

#### S2S event mode - development strategy

---

If you intend to use S2S event mode but you still don't know very well how to use the SDK, the best approach is to first start to use XMPP event mode to get experience. You don't need to setup any web server, just a simple connection to the Rainbow server is necessary. Using information available here ([Events and Methods available](/docs/sdk/csharp)) you can ensure you to use only elements available later in S2S event mode.

Once you understand well how CSharp SDK works, you have two choices:

-   **small step forward**: you still don't need to setup a real web server but just use a local one and a reverse proxy tool. It permits easily from you environment to have a local web server (often created by code) available and accesible by the Rainbow Server. With this approach you can learn how to use the method `ParseCallbackContent` of the `S2SEventPipe` object explained in previous chapter. A diagram in the next chapter permits to understand how it works.
-   **big step forward**: you configure your web server and use your environment correctly to provide the CSharp SDK with data from the Rainbow server via the callback URL.

**IMPORTANT NOTE**: The use of a reverse proxy must not at all be used in production environment - just in development process to test/setup quickly your code.

#### S2S event mode - use of reverse proxy for development/test purpose

---

To explain this kind of configuration, we will use here the ngrok tool. But you can use any tool with same kind of feature.

[ngrok](https://ngrok.com/) allows you to expose local server behind NATs and firewalls to the public internet over secure tunnels. So you don't need here to have a real web server running but just a local one. This tool is free and available for Windows, MacOS and Linux.

We will use [EmbedIO Nuget package](https://www.nuget.org/packages/EmbedIO/) to have your own local server. It's a free package and cross platform too. With this package, with less than 10 lines of code you can create and start a local web server.

This diagram explains how all this works together.

![](/docs/sdk/csharp)

  
  

It seems a bit complex but in fact it's very easy to setup and to understand.

1.  **ngrok instance**

Download ngrok for your environment and launch it using this command line:

**ngrok http -host-header="localhost:9870" 9870**

Once started, the tool indicates you the forwarding rule created from the public ngrok internet web site to your local web server running on 9870 (you can use/specify any port number)

For example, you can have a forward rule like this created by ngrok:

http://0bc3a3bc.ngrok.io -> http://localhost:9870

https://0bc3a3bc.ngrok.io -> http://localhost:9870

It means that all HTTP or HTTPS requests to the public web server `0bc3a3bc.ngrok.io` will be redirected to your local web server on port 9870.

**NOTE:** Each time your start ngrok another forward rule is created. It's important to notice also that the forward rule is only alive for a few hours (if your are using the free version of this tool). So in your development step, don't forget to check that the forward rule is still alive.

2.  **Third Party App**

Your third party app must create and start a local web server on port 9870.

Your third party app must use the CSharp SDK in S2S event mode and specify this callback Url: http://0bc3a3bc.ngrok.io/myPath

3.  **Rainbow events raised**

Since you specified this callback Url (http://0bc3a3bc.ngrok.io/myPath), Rainbow server sends them to the ngrok web server infrastructure which will forward them to your local web server using this URL: http://localhost:9870/myPath

4.  **HTTP(S) request are forwarded**

All HTTP and HTTPS requests are then forwarded, thanks to your ngrok instance, to your local web server on port 9870.

You need to get data from this web requests and provide them to the SDK using the method `ParseCallbackContent` of the `S2SEventPipe` object.

Once all these steps are done, your are using fully the CSharp SDK S2S event mode but not using tools (ngrok, local web server) adapted in real / business configuration.

The next step will be to manage/setup your real web server and your environment still using the CSharp SDK nearly in the same way:

-   the code to start the local web server must be removed
-   the code to get data from incoming web request must be adapted to your environment

That's it !

#### S2S examples

---

Two examples are available:

-   Console application [here](https://github.com/Rainbow-CPaaS/Rainbow-CSharp-SDK-Samples/blob/master/SDK%20V3.X/ConsoleApp/Conversations%20and%20IM-S2S/README.md)
-   Terminal application [here](https://github.com/Rainbow-CPaaS/Rainbow-CSharp-SDK-Samples/blob/master/SDK%20V3.X/TerminalApp/TerminalAppS2SPresencePanel/README.md)

#### Using Multiple Accounts

---

Whatever the event mode used, it's possible in the same process to create several `Rainbow.Application` (one for each account).

When S2S event mode is used, it's possible to use the same callback URL for all this account if you want to.

### Webhook

---

The Rainbow C# SDK also allows you to create `webhooks`. This is completely independent of event mode, but the architecture required to use them is identical to the one used in S2S event mode.

Also webhooks permits to receive eventsfor all users in the company - not just for the user using the SDK. It's why only an admin account can create / use them.

Not all events are available using Webhook. You must select which ones should be returned by the server when creating a subscription. Refer to chapter `Company Event WebHook / Subscription` in [Administration service](/docs/sdk/csharp) and to [WebHookEventPipe service](/docs/sdk/csharp)

Like S2S event mode, a callback URL must be used by the webhook. Exactly the same architecture is used (you need a web server) and the same development strategy can be used.

If you use S2S event mode and webhook in same time, you must specify a different endpoint for the callback URL. For example you can use:

-   https://my.server.domain/s2s for callback URL to manage S2S events
-   https://my.server.domain/webhook for callback URL to manage events for webhook subscription

#### Webhook - handle events from Rainbow server

---

To receive events from Rainbow server using a webhook (using [Administration service](/docs/sdk/csharp))

-   Create a `CompanyEventWebHook` using `CreateCompanyEventWebHookAsync()`. A valid callback URL must be provided
-   Create a `CompanyEventSubscription` using `CreateCompanyEventSubscriptionAsync()`. Event types we want to receive must be set here.

Your web server will receive data of the specified callback URL

-   with a specific HTTP verb (GET, POST, PUT, etc...)
-   with a specific content (JSON content)
-   with a content type

You must check that the `content type` is equal to `application/json`.

For the other data, you don't have to analyse / parse, you just need to provide them to the SDK - then it will parse the information, and, according the result, an event is raised by the SDK.

To do this you have to use the method `ParseCallbackContent` of the `WebHookEventPipe` service. This method returns a boolean to indicate if the parsing has been done correctly or not.

Your web server must always return an HTTP 200 Ok answer even if the parsing hhs not been done correclty.

NOTE: You can check the subscription status using `GetCompanyEventSubscriptionStatusAsync()`.

```csharp
Rainbow.Application myApp = new Rainbow.Application();
Rainbow.Administration rbAdministration = myApp.GetAdministration();
Rainbow.WebHookEventPipe webHookEventPipe = application.GetWebHookEventPipe();


// You set correctly AppdId, AppSecret, HostName and a valid account (login + pwd) using your Rainbow.Appliaction object

// You start the login ...

// You create a `CompanyEventWebHook` using a callback URL

// You create a `CompanyEventSubscription` using even types you want to manage

...

// Your Web server is receiving data from the Rainbow Server
protected override async Task OnRequestAsync(IHttpContext context)
{
    // We get the HTTP verb of the request (POST, GET, ...)
    String httpVerb = context.Request.HttpVerb.ToString();
    
    // We get the AbsolutePath of the request
    String absolutePath = context.Request.Url.AbsolutePath;
    
    // We get the body of the request
    String body = await context.GetRequestBodyAsStringAsync();
    
    // And finnaly we need the content-type of the body
    String? contentType = context.Request.Headers["Content-Type"];

    // We use Rainbow.WebHookEventPipe with this info
    Boolean result = false;
    log.LogDebug("[OnRequestAsync] RequestedPath:[{Path}] - HttpVerb:[{HttpVerb}]", absolutePath, httpVerb);

    if (contentType == "application/json")
    {
        result = await webHookEventPipe.ParseCallbackContentAsync(httpVerb, body);
    }
}
```

#### Webhook examples

---

Two examples are available:

-   Console application [Hub Device Status](https://github.com/Rainbow-CPaaS/Rainbow-CSharp-SDK-Samples/blob/master/SDK%20V3.X/ConsoleApp/Hub%20Devices%20Status/README.md)
-   Console application [Global Presence Level](https://github.com/Rainbow-CPaaS/Rainbow-CSharp-SDK-Samples/blob/master/SDK%20V3.X/ConsoleApp/Global%20Presence%20Level/README.md)

### Other Examples

---

You can take a look to several examples available [here](https://github.com/Rainbow-CPaaS/Rainbow-CSharp-SDK-Samples/tree/master/SDK%20V3.X/README.md)

### On this page

-   [XMPP, S2S (Server to server) and Webhook](/docs/sdk/csharp#name-xmpp-s2s-server-to-server-and-webhook-0)
-   [Event mode](/docs/sdk/csharp#name-event-mode-9)
-   [Select an event mode](/docs/sdk/csharp#name-select-an-event-mode-31)
-   [Event mode and architecture](/docs/sdk/csharp#name-event-mode-and-architecture-42)
-   [S2S event mode and architecture](/docs/sdk/csharp#name-s2s-event-mode-and-architecture-55)
-   [S2S event mode - handle events from Rainbow server](/docs/sdk/csharp#name-s2s-event-mode---handle-events-from-rainbow-server-71)
-   [S2S event mode - development strategy](/docs/sdk/csharp#name-s2s-event-mode---development-strategy-119)
-   [S2S event mode - use of reverse proxy for development/test purpose](/docs/sdk/csharp#name-s2s-event-mode---use-of-reverse-proxy-for-developmenttest-purpose-144)
-   [S2S examples](/docs/sdk/csharp#name-s2s-examples-254)
-   [Using Multiple Accounts](/docs/sdk/csharp#name-using-multiple-accounts-273)
-   [Webhook](/docs/sdk/csharp#name-webhook-283)
-   [Webhook - handle events from Rainbow server](/docs/sdk/csharp#name-webhook---handle-events-from-rainbow-server-314)
-   [Webhook examples](/docs/sdk/csharp#name-webhook-examples-369)
-   [Other Examples](/docs/sdk/csharp#name-other-examples-388)

---

Was this content helpful to you?YesNo

Feedback
---
title: "CPaaS SDK for business communication solutions | Rainbow"
description: "Add chat, conference, real time collaboration and communication (PBX, VoIP, P2P) capabilities, bots and more to your business applications."
type: "sdk"
source: "https://developers.openrainbow.com/doc/sdk/csharpprevious/core/lts/guides/070_managing_presence"
lastSynced: "2026-02-19T22:35:14.446Z"
---
# Documentation

Managing presence

LTS release 2.6.XPubliée le 2021-12-13

## Managing Presence

This guide explains how to get presence of contacts in your Roster and how to set the Presence of the current contact.

### Roster

---

The Roster is the list of contacts who share their presence with the current contact.

It's not possible to get presence of a contact which is not your Roster.

To get the list of contacts in you Roster, you need to use the `Contacts` object and use `GetAllContactsInRoster` method.

```csharp
Rainbow.Application myApp = new Rainbow.Application();
...
Rainbow.Contacts contacts = myApp.GetContacts();
...
// You need to log on the server ... 


contacts.GetAllContactsInRoster(callback =>
{
  if(callback.Result.Success)
  {
    List<Contact> contactsListInRoster = callback.data;
    // Now you can do want you want with these contacts
  }
  else
  {
    // A pb occurs
    if(callback.Result.Type == SdkError.SdkErrorType.IncorrectUse)
    {
      // Bad parameters used
      string errMsg = callback.Result.IncorrectUseError.ErrorMsg; 
    }
    else
    {
      // Exception occurs
      Exception e = callback.Result.ExceptionError;
    }
  }
});
```

Note: When you have a `Contact` object, it's easy to know it's in your Roster using the property `InRoster`.

### Get Contact Presence by devices

---

It's possible to get Contact Presence using `GetPresencesFromContact`, `GetPresencesFromContactId` or `GetPresencesFromContactJid` of `Contacts` service.

These methods returns a Dictionary of `Presence` object and not just one `Presence` object since a Contact can be connected to the Rainbow server using one or several devices.

The Dictionary is indexed using the resource ID of each devices using by this contact. This Dictionary is useful if you want to know specifically the contact presence for a specific device.

```csharp
Rainbow.Application myApp = new Rainbow.Application();
Rainbow.Contacts contacts = myApp.GetContacts();
...
Rainbow.Contact contact; // A Contact in the Roster

// You need to log on the server ... 

Dictionary<String, Presence> presences = contacts.GetPresencesFromContact(contact);

// Loop on each Presence object in the Dictionary
foreach(Presence presence in presences.Values)
{
  // presence.Apply                                     => True, if this presence must be used to build the aggregated presence.
  // presence.BasicNodeJid                              => The basic jid Node of the contact
  // presence.Date                                      => The Date when the presence has been set
  // presence.PresenceDetails / presence.PresenceLevel  => The IM Presence
  // presence.PresencePhoneState                        => The presence state of the phone (if any)
  // presence.Resource                                  => Resource Id specific of the contact device used
  // presence.Until                                     => in UTC format - The validity date until this presence is valid (if not equals to DateTime.MinValue). For calendar presence, if date is passed, it means that the user is "available" from a calendra presence point of view

}
```

### Get Aggregated Presence

---

If you don't need to know the Contact Presence by Device but just a summary, use the aggregated Presence information.

For this, use one of these methods `GetAggregatedPresenceFromContact`, `GetAggregatedPresenceFromContactId`, `GetAggregatedPresenceFromContactJid` of `Contact` object. Only one `Presence` object is returned is this case.

```csharp
Rainbow.Application myApp = new Rainbow.Application();
Rainbow.Contacts contacts = myApp.GetContacts();
...
Rainbow.Contact contact; // A Contact in the Roster

// You need to log on the server ... 

Presence presence = contacts.GetAggregatedPresenceFromContact(contact);
  // presence.Apply                                     => True, if this presence must be used to build the aggregated presence.
  // presence.BasicNodeJid                              => The basic jid Node of the contact
  // presence.Date                                      => The Date when the presence has been set
  // presence.PresenceDetails / presence.PresenceLevel  => The IM Presence
  // presence.PresencePhoneState                        => The presence state of the phone (if any)
  // presence.Resource                                  => Resource Id specific of the contact device used
  // presence.Until                                     => in UTC format - The validity date until this presence is valid (if not equals to DateTime.MinValue). For calendar presence, if date is passed, it means that the user is "available" from a calendra presence point of view

}
```

### Manage events related to presence

---

To be informed of Contact Presence update, you need to manage these events `ContactPresenceChanged`, `ContactAggregatedPresenceChanged` of `Contact` object.

`ContactPresenceChanged` is raised when the presence of a Contact is changed of one of its device. It's useful only if you want to know Contact Presence by device.

`ContactAggregatedPresenceChanged` is raised when the aggregated presence of a Contact is changed. It's useful only if you want to know the update of the Contact Presence summary.

So it's possible to have the event `ContactPresenceChanged` raised several times but not the event `ContactAggregatedPresenceChanged`.

```csharp
Rainbow.Application myApp = new Rainbow.Application();
Rainbow.Contacts contacts = myApp.GetContacts();
...

// We want to be informed of Contact Presence update by device
contacts.ContactPresenceChanged += Contacts_ContactPresenceChanged; 

// We want to be informed of Contact Presence summary update
contacts.ContactAggregatedPresenceChanged += Contacts_ContactAggregatedPresenceChanged;

// Handle Contact Presence update by device 
private void Contacts_ContactPresenceChanged(object sender, Rainbow.Events.PresenceEventArgs e)
{
  // e.Presence.Apply                                     => True, if this presence must be used to build the aggregated presence.
  // e.Presence.BasicNodeJid                              => The basic jid Node of the contact
  // e.Presence.Date                                      => The Date when the presence has been set
  // e.Presence.PresenceDetails / presence.PresenceLevel  => The IM Presence
  // e.Presence.PresencePhoneState                        => The presence state of the phone (if any)
  // e.Presence.Resource                                  => Resource Id specific of the contact device used
  // e.Presence.Until   
}

// Handle Contact Presence summary update 
private void Contacts_ContactAggregatedPresenceChanged(object sender, Rainbow.Events.PresenceEventArgs e)
{
  // e.Presence.Apply                                     => True, if this presence must be used to build the aggregated presence.
  // e.Presence.BasicNodeJid                              => The basic jid Node of the contact
  // e.Presence.Date                                      => The Date when the presence has been set
  // e.Presence.PresenceDetails / presence.PresenceLevel  => The IM Presence
  // e.Presence.PresencePhoneState                        => The presence state of the phone (if any)
  // e.Presence.Resource                                  => Resource Id specific of the contact device used
  // e.Presence.Until   
}
```

### Manage Presence of the current contact

---

To manage the Presence of the current contact of you have these methods in `Contacts` object:

-   `GetPresencesFromCurrentContact`: To get the Dictionary of the current Contact Presence (so to know by device the Presence)
-   `GetAggregatedPresenceFromCurrentContact`: to get the current Contact summary Presence

Same events, explained in previous chapter, must be used to know the update of the current contact from in `Contacts` object: `ContactPresenceChanged`, `ContactAggregatedPresenceChanged`.

To set the Presence of the current Contact, use `SetPresenceLevel` in `Contacts` object.

```csharp
Rainbow.Application myApp = new Rainbow.Application();
...
Rainbow.Contacts contacts = myApp.GetContacts();

// Need to log on the server ...

// Define the Presence of the current contact - here in "Do Not Disturb (in Presentation)"
String presenceLevel = Rainbow.Model.PresenceLevel.Dnd;
String presenceDetails = Rainbow.Model.PresenceDetails.Presentation;  

contacts.SetBusyPresenceAccordingMedias(Call.Media.AUDIO);
...
contacts.SetBusyPresenceAccordingMedias(Call.Media.VIDEO);
...
contacts.SetPresenceLevel(contacts.CreatePresence(true, PresenceLevel.Online));
...
contacts.SetPresenceLevel(contacts.CreatePresence(true, PresenceLevel.Dnd));
```

### Set default presence once connected to the server

---

By default the default presence set once onnected to the server it's **Online**.

It's possible to set another default presence using `SetDefaultPresenceLevel` method from `Application` object

```csharp
Rainbow.Application myApp = new Rainbow.Application();
Rainbow.Contacts contacts = myApp.GetContacts();

// Create a defautl presence level
Presence defaultPresence = new Presence(contacts.CreatePresence(true, PresenceLevel.Dnd));

// Set it in Application object
myApp.SetDefaultPresenceLevel(defaultPresence);
```

### Sur cette page

-   [Managing Presence](/docs/sdk/csharp#name-managing-presence-0)
-   [Roster](/docs/sdk/csharp#name-roster-6)
-   [Get Contact Presence by devices](/docs/sdk/csharp#name-get-contact-presence-by-devices-23)
-   [Get Aggregated Presence](/docs/sdk/csharp#name-get-aggregated-presence-37)
-   [Manage events related to presence](/docs/sdk/csharp#name-manage-events-related-to-presence-48)
-   [Manage Presence of the current contact](/docs/sdk/csharp#name-manage-presence-of-the-current-contact-65)
-   [Set default presence once connected to the server](/docs/sdk/csharp#name-set-default-presence-once-connected-to-the-server-91)

---

Ce contenu vous a-t-il été utile ?OuiNon

Feedback